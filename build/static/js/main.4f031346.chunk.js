(this["webpackJsonprtt-poc"]=this["webpackJsonprtt-poc"]||[]).push([[0],{27:function(e,t,n){e.exports=n(48)},32:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(8),c=n.n(i);n(32),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var o,u=n(3),s=n(2);!function(e){e[e.Collider=0]="Collider",e[e.SvgSprite=1]="SvgSprite",e[e.NavMeshAgent=2]="NavMeshAgent",e[e.NavMeshHole=3]="NavMeshHole"}(o||(o={}));var l=function(e){return function(t){return t.type===e}},f=n(4),p=n(1),h=n(24),d=n(18),v=function(e,t){for(var n=[],a=0;a<e;a++)n.push(t(a));return n},m=function(e,t,n){var a=e.indexOf(t);if(-1===a)return e;var r=Object(f.a)(e);return n?r.splice(a,1,n):r.splice(a,1),r},b=2*Math.PI,g=function(e,t){var n=Object(p.a)(e,2),a=n[0],r=n[1],i=Object(p.a)(t,2),c=i[0],o=i[1];return a===c&&r===o},O=function(e,t){var n=Object(p.a)(e,2),a=n[0],r=n[1],i=Object(p.a)(t,2);return[a+i[0],r+i[1]]},j=function(e,t){return e.map((function(e){return e*t}))},E=function(e,t){var n=Object(p.a)(e,2),a=n[0],r=n[1];return[a*Math.cos(t)-r*Math.sin(t),a*Math.sin(t)+r*Math.cos(t)]},y=function(e,t){var n=Object(p.a)(e,2),a=n[0],r=n[1],i=Object(p.a)(t,2),c=i[0],o=i[1];return Math.sqrt(Math.pow(c-a,2)+Math.pow(o-r,2))},M=function(e,t){var n=Object(p.a)(e,2),a=n[0],r=n[1],i=Object(p.a)(t,2),c=i[0],o=i[1];return(Math.atan2(o-r,c-a)+b)%b*180/Math.PI},k=function(e,t){return[e,t]},w=n(19),S=n.n(w),N=n(25),A=n(26),x=n.n(A),C=function(e,t,n){return t<n?e>=t&&e<=n:e>=t||e<=n},_=function(e,t,n){var a=M.apply(void 0,Object(f.a)(e));return t.every((function(t){var r=function(e,t){var n=Object(p.a)(e,2),a=Object(p.a)(n[0],2),r=a[0],i=a[1],c=Object(p.a)(n[1],2),o=c[0],u=c[1],s=Object(p.a)(t,2),l=Object(p.a)(s[0],2),f=l[0],h=l[1],d=Object(p.a)(s[1],2),v=o-r,m=u-i,b=d[0]-f,g=d[1]-h,O=(-m*(r-f)+v*(i-h))/(-b*m+v*g),j=(b*(i-h)-g*(r-f))/(-b*m+v*g);return O>=0&&O<=1&&j>=0&&j<=1?[r+j*v,i+j*m]:null}(e,t.line);if(!r)return!0;if(!g(r,e[0])&&!g(r,e[1]))return!1;var i=t.corners.find((function(e){return g(e.p,r)}));return i?n?g(r,e[0])?C(a,i.thetaAOpposite,i.thetaB):C(a,i.thetaA,i.thetaBOpposite):C(a,i.thetaA,i.thetaB)||C(a,i.thetaAOpposite,i.thetaBOpposite):g(r,e[1])||C(a,t.angleOpposite,t.angle)}))},z=function(e){for(var t=[],n=e.map((function(t){var n=m(e,t).map((function(e){return e.map((function(e){return e.line[0]}))}));return t.filter((function(e){return n.every((function(t){return-1!==x()(t,e.line[0])}))}))})).flat(),a=e.flat(),r=Object(f.a)(n),i=function(){var e=r.pop();if(!e)return"break";var n=m(a,e);r.forEach((function(a){var r=[e.line[0],a.line[0]];_(r,n)&&t.push(r)}))};;){if("break"===i())break}return t},B=function(e,t,n,a){var r=function(e){var t=S()();return e.forEachNode((function(e){t.addNode(e.id,e.data)})),e.forEachLink((function(e){t.addLink(e.fromId,e.toId,e.data)})),t}(e),i=n.join(),c=a.join(),o=_([n,a],t,!0);return r.addNode(i,n),r.addNode(c,a),o&&r.addLink(i,c,y(n,a)),t.forEach((function(e){var o=m(t,e),u=e.line[0],s=k(n,u),l=k(u,a);_(s,o,!0)&&r.addLink(i,u.join(),y(n,u)),_(l,o,!0)&&r.addLink(u.join(),c,y(u,a))})),Object(N.aStar)(r,{distance:function(e,t,n){return n.data}}).find(i,c).map((function(e){return e.data})).reverse().slice(1)},I=function(e,t){var n={},a=function(e,a){var r="".concat(t,"/").concat(e);return n[r]=a,function(e){return{type:r,payload:e}}};return{configureAction:a,reducer:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,a=arguments.length>1?arguments[1]:void 0,r=n[a.type];return r?r(a.payload)(t):t},update:a("UPDATE",(function(e){return function(t){return Object(u.a)({},t,{},e)}}))}},P={position:[0,0],scale:1},H=I({width:0,height:0,camera:P,entities:[],navMesh:[]},"ENGINE"),L=H.reducer,T=H.update,F=H.configureAction,W=L,X=T,q=F("TICK",(function(e){return function(t){var n=t.entities.map((function(t){var n=t.facets.find(l(o.NavMeshAgent));if(!n)return t;var a=Object(h.a)(n.path),r=a[0],i=a.slice(1);if(!r)return t;var c=Object(p.a)(t.position,2),s=c[0],f=c[1],d=Object(p.a)(r,2),v=d[0],b=d[1],g=n.velocity*(e/1e3);if(y(t.position,r)<=g){var j=m(t.facets,n,Object(u.a)({},n,{path:i}));return Object(u.a)({},t,{position:r,facets:j})}var E=Math.atan2(b-f,v-s),M=[Math.cos(E)*g,Math.sin(E)*g],k=O(t.position,M);return Object(u.a)({},t,{rotation:E+Math.PI/2,position:k})}));return Object(u.a)({},t,{entities:n})}})),D=Object(d.a)((function(e){return e}),(function(e){var t=[];return e.forEach((function(e){var n=e.facets.filter(l(o.NavMeshHole)).map((function(t){return t.shape.map((function(t){return O(E(t,e.rotation),e.position)}))}));t.push.apply(t,Object(f.a)(n))})),t})),G=Object(d.a)((function(e){return e.navMesh}),(function(e){return function(e){var t=S()();return z(e).forEach((function(e){var n=Object(p.a)(e,2),a=n[0],r=n[1],i=a.join(),c=r.join();t.addNode(i,a),t.addNode(c,r),t.addLink(c,i,y(a,r))})),t}(e)})),J=n(7),R=I({selected:["player_scissors"],teams:[],playerTeam:"blue"},"XHESS"),U=R.reducer,V=R.update,K=Object(J.b)({engine:W,xhess:U}),Y=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||J.c,$=Object(J.d)(K,Y()),Q=function(){return Object(s.d)().getState()},Z=(s.c,function(e){var t=e.facet,n=e.entity,i=e.children,c=Object(s.b)(),o=Q().xhess,u=o.teams.find((function(e){return e.entities.includes(n.id)})),l=u?u.color:"grey",f=Object(a.useMemo)((function(){return["translate(".concat(j(t.size,-.5).join(" "),")"),"scale(".concat(j(t.size,1/512).join(" "),")")].join(" ")}),[t.size]);return r.a.createElement("g",{transform:f,fill:l,onClick:function(){u&&u.name===o.playerTeam&&c(V({}))}},i)}),ee=function(e){var t=e.facet,n=Q().engine;return r.a.createElement("rect",{width:t.size[0],height:t.size[1],stroke:"black",strokeWidth:3/n.camera.scale,fill:"rgba(0, 0, 0, 0.2)"})},te=[{id:"navigable_area",position:[0,0],rotation:0,facets:[{type:o.SvgSprite,size:[0,0],Component:function(){var e=Object(s.b)(),t=Q(),n=t.engine,a=t.xhess,i=n.width,c=n.height,f=n.camera;return r.a.createElement("rect",{width:i,height:c,fill:"rgba(0, 0, 0, 0)",onClick:function(t){var r=t.currentTarget.getBoundingClientRect(),i=r.left,c=r.top,s=j([t.clientX-i,t.clientY-c],1/f.scale),p=G(n),h=n.entities.map((function(e){if(!a.selected.includes(e.id))return e;var t=e.facets.find(l(o.NavMeshAgent));if(!t)return e;var r=B(p,n.navMesh.flat(),e.position,s);return Object(u.a)({},e,{facets:m(e.facets,t,Object(u.a)({},t,{path:r}))})}));e(X({entities:h}))}})}}]},{id:"player_scissors",position:[2.5,1.5],rotation:0,facets:[{type:o.SvgSprite,size:[1,1],Component:function(e){return r.a.createElement(Z,e,r.a.createElement("path",{d:"M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm292 116V256h70.9c10.7 0 16.1-13 8.5-20.5L264.5 121.2c-4.7-4.7-12.2-4.7-16.9 0l-115 114.3c-7.6 7.6-2.2 20.5 8.5 20.5H212v116c0 6.6 5.4 12 12 12h64c6.6 0 12-5.4 12-12z"}))}},{type:o.NavMeshAgent,path:[],velocity:9}]},{id:"box1",position:[2,2],rotation:Math.PI/16,facets:[{type:o.SvgSprite,size:[7,1],Component:ee},{type:o.NavMeshHole,shape:[[-.5,-.5],[7.5,-.5],[7.5,1.5],[-.5,1.5]]}]},{id:"box2",position:[4,11],rotation:-Math.PI/4,facets:[{type:o.SvgSprite,size:[7,1],Component:ee},{type:o.NavMeshHole,shape:[[-.5,-.5],[7.5,-.5],[7.5,1.5],[-.5,1.5]]}]},{id:"ring",position:[5,5],rotation:0,facets:[{type:o.SvgSprite,size:[1,1],Component:function(){return r.a.createElement("circle",{r:2})}},{type:o.NavMeshHole,shape:function(e,t){var n=b/t;return v(t,(function(t){return E([e,0],t*n)}))}(2.5,16)}]}],ne=function(){var e=Object(s.b)();return Object(a.useEffect)((function(){var t;e(X({entities:te,navMesh:(t=D(te),t.map((function(e){return e.map((function(t,n){var a=e[(n-1+e.length)%e.length],r=e[(n+1)%e.length],i=e[(n+2)%e.length],c=[t,r],o=M.apply(void 0,c),u=(o+180)%360;return{line:c,angle:o,angleOpposite:u,corners:[{p:t,thetaA:M(a,t),thetaAOpposite:M(t,a),thetaB:o,thetaBOpposite:u},{p:r,thetaA:o,thetaAOpposite:u,thetaB:M(r,i),thetaBOpposite:M(i,r)}]}}))})))})),e(V({teams:[{name:"blue",color:"blue",entities:["player_rock","player_paper","player_scissors"]}]}))}),[e]),null},ae=function(){var e=Q().engine,t=e.camera.scale,n=e.width/t,a=e.height/t,i=Math.floor(a),c=Math.floor(n);return r.a.createElement("g",{stroke:"#dddddd"},v(i,(function(e){return r.a.createElement("line",{key:e,x1:0,y1:e,x2:n,y2:e})})),v(c,(function(e){return r.a.createElement("line",{key:e,x1:e,y1:0,x2:e,y2:a})})))},re=function(){var e=Q().engine,t=Object(a.useMemo)((function(){return z(e.navMesh)}),[e.navMesh]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("g",{stroke:"rgba(255, 0, 0, 0.3)"},t.map((function(t,n){var a=Object(p.a)(t,2),i=Object(p.a)(a[0],2),c=i[0],o=i[1],u=Object(p.a)(a[1],2),s=u[0],l=u[1];return r.a.createElement(r.a.Fragment,{key:n},r.a.createElement("circle",{cx:c,cy:o,r:2/e.camera.scale,fill:"red"}),r.a.createElement("line",{x1:c,y1:o,x2:s,y2:l}),r.a.createElement("circle",{cx:s,cy:l,r:2/e.camera.scale,fill:"red"}))}))),r.a.createElement("g",{fill:"rgba(255, 0, 0, 0.05)"},e.navMesh.map((function(e,t){return r.a.createElement("polygon",{key:t,points:e.map((function(e){return e.line[0].join()})).join(" ")})}))))},ie=function(){var e=Q().engine,t=e.camera.scale,n=e.entities.map((function(e){return[e.position].concat(Object(f.a)(e.facets.filter(l(o.NavMeshAgent)).map((function(e){return e.path})).flat()))})).map((function(e){return(t=e,t.map((function(e,n){return k(e,t[(n+1)%t.length])}))).slice(0,-1);var t})).flat();return r.a.createElement("g",{stroke:"lightgreen",strokeWidth:2/t},n.map((function(e,t){var n=Object(p.a)(e,2),a=Object(p.a)(n[0],2),i=a[0],c=a[1],o=Object(p.a)(n[1],2),u=o[0],s=o[1];return r.a.createElement("line",Object.assign({key:t},{x1:i,y1:c,x2:u,y2:s}))})))},ce=function(e){var t=Q().engine.camera.scale;return r.a.createElement("g",{strokeWidth:1/t},e.showGrid&&r.a.createElement(ae,null),e.showNavMesh&&r.a.createElement(re,null),e.showPaths&&r.a.createElement(ie,null))},oe=function(e){var t=e.engine,n=t.width,a=t.height,i=t.camera,c=t.entities,u=["scale(".concat(i.scale,")"),"translate(".concat(i.position.join(" "),")")].join(" ");return r.a.createElement("svg",{width:n,height:a,viewBox:"0 0 ".concat(n," ").concat(a),style:{border:"1px solid black"}},r.a.createElement("g",{transform:u},e.debug&&r.a.createElement(ce,e.debug),c.map((function(e){var t=e.facets.find(l(o.SvgSprite));return t?r.a.createElement("g",{key:e.id,transform:"translate(".concat(e.position.join(" "),") rotate(").concat(180*e.rotation/Math.PI," 0 0)")},r.a.createElement(t.Component,{facet:t,entity:e})):null}))),e.children)},ue=function(){var e=Object(s.b)();!function(e){var t=Object(a.useState)(),n=Object(p.a)(t,2)[1];Object(a.useEffect)((function(){var t,a=0;return t=requestAnimationFrame((function r(i){e(i-a),n({}),a=i,t=requestAnimationFrame(r)})),function(){return cancelAnimationFrame(t)}}),[e])}(Object(a.useCallback)((function(t){return e(q(t))}),[e]));var t=Q().engine;return r.a.createElement(oe,{engine:t,debug:{showNavMesh:!0,showPaths:!0}})};c.a.render(r.a.createElement((function(){return Object(a.useEffect)((function(){$.dispatch(X({width:800,height:450,camera:Object(u.a)({},P,{scale:25})}))}),[]),r.a.createElement(s.a,{store:$},r.a.createElement(ue,null),r.a.createElement(ne,null))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[27,1,2]]]);
//# sourceMappingURL=main.4f031346.chunk.js.map